@{
    ViewData["Title"] = "Create Profile";
    var userId = Context.Request.Query["uid"].ToString();
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js';
        import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD1cKu3p7mNrl5bJUT_zLPgI22uiWDiCcc",
            authDomain: "studentmanagement-fe332.firebaseapp.com",
            projectId: "studentmanagement-fe332",
            storageBucket: "studentmanagement-fe332.appspot.com",
            messagingSenderId: "116679627050",
            appId: "1:116679627050:web:79a87a58b33b12412ace53"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Function to add a profile to Firebase
        async function addProfile(uid, userName, fullName, bio) {
            try {
                const profileRef = ref(database, `profiles/${uid}`);
                await set(profileRef, { uid, userName, fullName, bio });
                console.log('Profile added successfully');

                // Redirect to myProfile page after successful profile creation
                window.location.href = `/User/myProfile?uid=${uid}`;
            } catch (error) {
                console.error('Error adding profile:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Attach the event listener to the form submit
            document.getElementById('createForm').addEventListener('submit', (event) => {
                event.preventDefault();

                // Get the form values
                const uid = document.getElementById('uid').value;
                const userName = document.getElementById('username').value;
                const fullName = document.getElementById('fullName').value;
                const bio = document.getElementById('bio').value;

                // Call the addProfile function to add the profile to Firebase
                addProfile(uid, userName, fullName, bio);

                // Clear the form fields
                document.getElementById('createForm').reset();
            });
        });
    </script>
</head>

<body>
    <h2 class="mb-4">Create Profile</h2>
    <form id="createForm">
        <input type="hidden" id="uid" name="uid" value="@userId" />
        <div class="mb-3">
            <label for="username">Username:</label><br>
            <input type="text" id="username" name="username" required>
        </div>
        <div class="mb-3">
            <label for="fullName">Full Name:</label><br>
            <input type="text" id="fullName" name="fullName" required>
        </div>
        <div class="mb-3">
            <label for="bio">Bio:</label><br>
            <textarea id="bio" name="bio" rows="4" cols="50"></textarea>
        </div>
        <button class="btn btn-primary" type="submit">Save</button>
    </form>
</body>

</html>
